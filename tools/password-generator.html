<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>密码生成器 - 工具箱</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../css/style.css">
    <style>
        .strength-meter {
            height: 8px;
            transition: all 0.3s ease;
        }
        .history-item {
            transition: background-color 0.2s;
        }
    </style>
</head>
<body>
    <!-- 统一导航栏 -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary sticky-top">
        <div class="container">
            <a class="navbar-brand" href="../index.html">
                <i class="bi bi-tools me-2"></i>工具箱
            </a>
            <!-- 导航菜单项 -->
        </div>
    </nav>

    <div class="container py-5">
        <div class="row mb-4">
            <div class="col-md-8">
                <h1 class="mb-3"><i class="bi bi-shield-lock me-2 text-primary"></i>密码生成器</h1>
                <p class="lead">生成高强度的随机密码，支持自定义字符组合和排除特定字符</p>
            </div>
        </div>

        <div class="row">
            <div class="col-lg-8">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-4"><i class="bi bi-gear"></i> 生成设置</h5>
                        
                        <div class="mb-4">
                            <label class="form-label">密码长度：<span id="lengthValue">12</span></label>
                            <input type="range" class="form-range" id="lengthRange" min="6" max="32" value="12">
                        </div>

                        <div class="row g-3 mb-4">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="uppercase" checked>
                                    <label class="form-check-label" for="uppercase">
                                        大写字母 (A-Z)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="lowercase" checked>
                                    <label class="form-check-label" for="lowercase">
                                        小写字母 (a-z)
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="numbers" checked>
                                    <label class="form-check-label" for="numbers">
                                        数字 (0-9)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="symbols">
                                    <label class="form-check-label" for="symbols">
                                        符号 (!@#$%^&*)
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="mb-4">
                            <label class="form-label">排除字符</label>
                            <input type="text" class="form-control" id="excludeChars" 
                                placeholder="输入需要排除的字符（例如：o0O1l）">
                        </div>

                        <div class="d-grid gap-2">
                            <button class="btn btn-primary" id="generateBtn">
                                <i class="bi bi-arrow-repeat me-2"></i>生成新密码
                            </button>
                        </div>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-4"><i class="bi bi-clipboard"></i> 密码操作</h5>
                        
                        <div class="input-group mb-3">
                            <input type="text" class="form-control" id="passwordOutput" readonly>
                            <button class="btn btn-success" id="copyBtn">
                                <i class="bi bi-clipboard-check me-2"></i>复制
                            </button>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">密码强度</label>
                            <div class="progress">
                                <div class="progress-bar strength-meter" role="progressbar" 
                                    style="width: 0%" aria-valuenow="0"></div>
                            </div>
                        </div>

                        <div class="alert alert-warning" id="safetyTips">
                            <i class="bi bi-info-circle me-2"></i>安全建议：建议启用所有字符类型以获得最佳安全性
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4">
                <div class="card mb-4">
                    <div class="card-body">
                        <h5 class="card-title mb-3"><i class="bi bi-clock-history"></i> 生成历史</h5>
                        <div class="list-group" id="historyList">
                            <!-- 历史记录动态加载 -->
                        </div>
                        <button class="btn btn-outline-danger w-100 mt-3" id="clearHistoryBtn">
                            <i class="bi bi-trash me-2"></i>清除历史
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 初始化配置
        let passwordHistory = JSON.parse(localStorage.getItem('passwordHistory')) || [];
        renderHistory();
        
        // 密码生成函数
        function generatePassword() {
            const length = parseInt(document.getElementById('lengthRange').value);
            const includeUppercase = document.getElementById('uppercase').checked;
            const includeLowercase = document.getElementById('lowercase').checked;
            const includeNumbers = document.getElementById('numbers').checked;
            const includeSymbols = document.getElementById('symbols').checked;
            const exclude = document.getElementById('excludeChars').value;

                let charset = '';
            if (includeUppercase) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            if (includeLowercase) charset += 'abcdefghijklmnopqrstuvwxyz';
            if (includeNumbers) charset += '0123456789';
            if (includeSymbols) charset += '!@#$%^&*()_+-=[]{}|;:,.<>?';
            
            // 排除指定字符
            if (exclude) {
                const excludePattern = new RegExp(`[${exclude}]`, 'g');
                charset = charset.replace(excludePattern, '');
            }
            
            if (!charset) {
                alert('请至少选择一种字符类型！');
                return;
            }
            
            let password = '';
            for (let i = 0; i < length; i++) {
                password += charset[Math.floor(Math.random() * charset.length)];
            }
            
            document.getElementById('passwordOutput').value = password;
            updateStrengthIndicator(password);
            saveToHistory(password);
            updateStrengthDisplay();  // 触发强度显示更新
        }

        function updateStrengthIndicator(password) {
            let strength = 0;
            const length = password.length;
            
            // 获取当前字符集
            const charset = generateCharset();
            // 生成密码后保存到历史记录
            saveToHistory(password);
            
            // 字符类型得分
            const typeScores = {
                hasLower: /[a-z]/.test(password),
                hasUpper: /[A-Z]/.test(password),
                hasNumber: /\d/.test(password),
                hasSymbol: /[!@#$%^&*()_+\-=\[\]{}|;:,.<>?]/.test(password)
            };
            
            const typeCount = Object.values(typeScores).filter(Boolean).length;
            strength += typeCount * 15;
            
            // 长度得分
            strength += Math.min(30, Math.floor(length / 32 * 30));
            
            // 熵值计算（补充有效字符集长度）
            const validCharsetLength = charset.replace(/[^\w\s]/g, '').length || 1;
            const entropy = Math.log2(Math.pow(validCharsetLength, length));
            strength += Math.min(40, entropy / 4);
            
            // 更新进度条
            const progressBar = document.querySelector('.strength-meter');
            progressBar.style.width = Math.min(100, strength) + '%';
            progressBar.className = `progress-bar strength-meter bg-${getStrengthColor(strength)}`;
        }
        
        function getStrengthColor(strength) {
            if (strength > 75) return 'success';
            if (strength > 50) return 'primary';
            if (strength > 25) return 'warning';
            return 'danger';
        }
        function saveToHistory(password) {
            passwordHistory.unshift({
                password,
                timestamp: new Date().toISOString()
            });
            
            if (passwordHistory.length > 20) passwordHistory.pop();
            localStorage.setItem('passwordHistory', JSON.stringify(passwordHistory));
            renderHistory();
        }
        
        function renderHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = passwordHistory.map((item, index) => `
                <div class="list-group-item history-item d-flex justify-content-between align-items-center">
                    <span class="text-truncate" style="max-width: 70%">${item.password}</span>
                    <small class="text-muted">${new Date(item.timestamp).toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' })}</small>
                    <button class="btn btn-sm btn-outline-primary" onclick="copyHistory(${index})">
                        <i class="bi bi-clipboard"></i>
                    </button>
                </div>
            `).join('');
        }
        
        function copyHistory(index) {
            navigator.clipboard.writeText(passwordHistory[index].password)
                .then(() => alert('已复制到剪贴板'))
                .catch(() => alert('复制失败，请手动复制'));
        }
        
        function clearHistory() {
            passwordHistory = [];
            localStorage.removeItem('passwordHistory');
            renderHistory();
        }
        function copyPassword() {
            const password = document.getElementById('passwordOutput').value;
            if (!password) {
                alert('请先生成密码');
                return;
            }
            
            navigator.clipboard.writeText(password)
                .then(() => showToast('密码已复制到剪贴板！'))
                .catch(() => showToast('复制失败，请手动复制', 'danger'));
        }
        
        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast align-items-center text-white bg-${type} border-0`;
            toast.innerHTML = `
                <div class="d-flex">
                    <div class="toast-body">
                        ${message}
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
                </div>
            `;
            
            document.body.appendChild(toast);
            new bootstrap.Toast(toast, { autohide: true, delay: 2000 }).show();
            setTimeout(() => toast.remove(), 3000);
        }
        // 保存用户偏好设置
        function savePreferences() {
            const preferences = {
                length: document.getElementById('lengthRange').value,
                uppercase: document.getElementById('uppercase').checked,
                lowercase: document.getElementById('lowercase').checked,
                numbers: document.getElementById('numbers').checked,
                symbols: document.getElementById('symbols').checked
            };
            localStorage.setItem('passwordPreferences', JSON.stringify(preferences));
        }
        
        // 加载用户偏好设置
        function loadPreferences() {
            const saved = JSON.parse(localStorage.getItem('passwordPreferences')) || {};
            document.getElementById('lengthRange').value = saved.length || 12;
            document.getElementById('uppercase').checked = saved.uppercase !== undefined ? saved.uppercase : true;
            document.getElementById('lowercase').checked = saved.lowercase !== undefined ? saved.lowercase : true;
            document.getElementById('numbers').checked = saved.numbers !== undefined ? saved.numbers : true;
            document.getElementById('symbols').checked = saved.symbols || false;
            updateLengthDisplay();
        }

        // 事件监听
        document.getElementById('generateBtn').addEventListener('click', generatePassword);
        document.getElementById('lengthRange').addEventListener('input', () => {
    savePreferences();
    updateLengthDisplay();
});
        document.querySelectorAll('.form-check-input').forEach(input => {
            input.addEventListener('change', savePreferences);
        });
        document.getElementById('copyBtn').addEventListener('click', copyPassword);
        document.getElementById('clearHistoryBtn').addEventListener('click', clearHistory);
        function updateLengthDisplay() {
            document.getElementById('lengthValue').textContent = document.getElementById('lengthRange').value;
        }
        
        // 初始化页面
        loadPreferences();
        updateLengthDisplay();
        renderHistory();
        
        // 实时安全建议
        document.querySelectorAll('.form-check-input').forEach(input => {
            input.addEventListener('change', () => {
                const selectedTypes = Array.from(document.querySelectorAll('.form-check-input:checked')).length;
                const tips = document.getElementById('safetyTips');
                if (selectedTypes < 3) {
                    tips.innerHTML = `<i class="bi bi-exclamation-triangle me-2"></i>
                        安全警告：建议启用至少三种字符类型`;
                    tips.className = 'alert alert-danger';
                } else {
                    tips.innerHTML = `<i class="bi bi-check-circle me-2"></i>
                        安全状态良好`;
                    tips.className = 'alert alert-success';
                }
            });
        });
    </script>
</body>
</html>